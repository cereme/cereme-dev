{"componentChunkName":"component---src-templates-blog-post-js","path":"/frontend/agento-extension-retrospective/","result":{"data":{"site":{"siteMetadata":{"title":"cereme.dev","author":"cereme","siteUrl":"https://cereme.dev","comment":{"disqusShortName":"","utterances":"cereme/cereme.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"b649643b-049f-5e3c-b2d4-dba75abdcdfc","excerpt":"프로젝트 소개 \n\n\n 로켓펀치, 원티드, 잡플래닛 등 요즘 IT업계에서 특히 많이 사용되고 있는 구인 구직 사이트에서 편하게 해당 업체의 병역지정업체 여부를 보여주는 확장프로그램입니다! 해당 페이지에서 회사 이름을 가져와서 산업지원 병역일터 사이트에 쿼리를 보내 정보를 가져온 후, 보기 쉽게 병역정보 div를 추가해주는 방식이죠!  Github : https://github.com/cereme/agento Chrome web store : https://chrome.google.com…","html":"<h1 id=\"프로젝트-소개\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%86%8C%EA%B0%9C\" aria-label=\"프로젝트 소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프로젝트 소개</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACCklEQVQoz32SzWsTYRDG86eIH2dPPWhOgvTmwYOH2osWejVYPHmw2IM5qZDiwYLpJbG1ih8XK4Qq1mjQNtESsRUlxaZJNtnsJtlN9qP78fPdbZOIFgeG2Xn3meeZGSaiyBLtZp1ep4ljaugtGbXRQJXb6LqNaTm0Ox1UtY1hmNQbMtVaHbleC/E+++a6Lo7wyPWxEeZiUVZnL/A0fpGZS6dJxEZ5l75JqbSJYpqsFdYFkYphusw9uM+V6RnGJydJ3JigmElSlcqYgrTnCMLb40dYmh4lGZ8gNhbl8tmjTJ07xqPEVXIf35BdvMP6+yy2KChubJC4d5dr8VuciJ5h5ORxFqZO8TJ+ntyzWaRGhcjW6kO+F1bIFz5RyH/g7etlXj1P8yWfZbf0FbmYYWmlx/JnUKVtNre+sSaI59MLpFLzpJKPySy+oJR7glT+QYT/mOtBSzeo1JooqkbPNP/BSAr8LA/ziOc6+J6H7/t4InqeiyeWG8Rg0YZhoHd1LMtib28vxLhCyXEckTuCIvBhTdhhAOz2eoKUIbGIwfff5h+89/94ni8m8Qd1kT7Atm3kpsJOucL2rx0s2w4LbCEWnMlupSpOyBoQK6pKTWoIrw+EgyYOCPeVNU0XN6fRbnfCkQILYkvkHfHeFwmxepeOwGu6Ljr0hoR/jnHYaLooCLoM1hLEvvihaxD+G7gQ1p0cx2+qAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/7b4262c220512119075471c28d83f3df/c1b63/agento-toss-rocketpunch.png\"\n        srcset=\"/static/7b4262c220512119075471c28d83f3df/5a46d/agento-toss-rocketpunch.png 300w,\n/static/7b4262c220512119075471c28d83f3df/0a47e/agento-toss-rocketpunch.png 600w,\n/static/7b4262c220512119075471c28d83f3df/c1b63/agento-toss-rocketpunch.png 1200w,\n/static/7b4262c220512119075471c28d83f3df/6edca/agento-toss-rocketpunch.png 1351w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACMElEQVQ4y61Ty4rUQBTNf4r4BYL4CaLgQneCK10MguAD/ILu9A/INMxGaGake0gyeT/qlVSS473VndgZQVwYOLlVqapT59x747199wVvPt3g2fMXePDwEV6+eo31ZoP12l/A9328/+rj4puPDY1X89oaq9UaHz5+xuMnT+HdlcDFCv/t8bI4Qnj4ge12i91uh7ZtMY4jhmH4A/0J43hv7TTv+x7eoYhxG0bI0gxlWcJa+1cFfNk5louksO07dExCE76h6zoXmZjBc47aKhRW0LYliexbiN6gonUzWnhKatRSQCgJpQykVJBKHSNBSAkhJCpRIiEoY6AJSlMk5KpBoQUSWaGQDTxBhxojUVQ5DMXhLH9TLic7tDjnKstyNE2D3vYwSsN2lgRoskyWmqpGk6UYTL2wwwfDuwQ1HWTr08OkhlU6J9LlnslZtWdMi30T46o8YG8KBATRaQz9AEuEQRQ7iwONf180HG0TYVVVLrp8klJHeF2FuMxvELYlpDWuSKyCNxyCyOXxvkIhhFM2qVsQ7uoQ3/NrXDZ73JocI6sj0smy0tqNp7bhPOd5jiAIUNf13D4zYaRL/NQJWc5Q93pOPpNGcerydK6QCYqiRBRFjnDqXUcoBPUPbZZGQ7Yamv6Utu0cmKSj6tlTf7rv3RFFUThCziEXaCbkV5KmSKkNuAX40NTUrJ6tOnIaH9tpdEVhoiRJXEEWlrk5DR3StnO5Gf8BTMyF4IKwuqlXmfAXIbiASyiV56wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/d2756f70e3711f1cf3d63494cf3171fd/c1b63/agento-toss-jobplanet.png\"\n        srcset=\"/static/d2756f70e3711f1cf3d63494cf3171fd/5a46d/agento-toss-jobplanet.png 300w,\n/static/d2756f70e3711f1cf3d63494cf3171fd/0a47e/agento-toss-jobplanet.png 600w,\n/static/d2756f70e3711f1cf3d63494cf3171fd/c1b63/agento-toss-jobplanet.png 1200w,\n/static/d2756f70e3711f1cf3d63494cf3171fd/d61c2/agento-toss-jobplanet.png 1800w,\n/static/d2756f70e3711f1cf3d63494cf3171fd/fbd44/agento-toss-jobplanet.png 2215w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABU0lEQVQoz3VSbXKDIBT0/tfoffqnvUAajV+gsYoKgtu3RFPTpMy8UVhYdpeXjBbQTYcsS3E6fSFNU+R5jmmawLGuK14NrocN4+ftfYmVLEvANFsYY2KNI2uE9/52KIRbyf96qAdiwT9yj8/CI9FaoSgKtG0D01tYw134f2xkSmtxlT3BCVVdLpdYdaVQlUoUz5Gz73sUZYmqqqCUghYS61w82DTN3VXbtoJrcTYhma2VDBuMkhk3h+DhxYJbA8xgBGt/MYnBSnlR+d11kbiTLy9cliVaT5xspJJhGDCLMubnrIvWOCdGFXwkFg9Fy6KYyoizDpZHpJJFVauoNG4SAr/dnjGK+maX85lKNkJ2A4XwAfcHSjhxWy7Hl6MFrv/FdoXMkFZ5CV3dCfc22NtjJ7OSrYuZhsf2OVg+n8+RlNE8Eb7qsX3TK5zRlNIB1+v1fgmxH2/JCqJenE5FAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/2633dc9d97940b26e42296ef68923ac8/c1b63/agento-toss-wanted.png\"\n        srcset=\"/static/2633dc9d97940b26e42296ef68923ac8/5a46d/agento-toss-wanted.png 300w,\n/static/2633dc9d97940b26e42296ef68923ac8/0a47e/agento-toss-wanted.png 600w,\n/static/2633dc9d97940b26e42296ef68923ac8/c1b63/agento-toss-wanted.png 1200w,\n/static/2633dc9d97940b26e42296ef68923ac8/d61c2/agento-toss-wanted.png 1800w,\n/static/2633dc9d97940b26e42296ef68923ac8/2fb55/agento-toss-wanted.png 2201w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 443px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABiklEQVQoz61SXWvbMBT1//8rbfq2PAQ26ENho33oBknXwCDbEmrHkixLsqwv++zKbtIWxvoyweF+SDr3SPcWvXPw3sORde7ZUuxDoPwJHjFGpJQga4veOjRNg0Bncv6EfK5IacD/XEVvLa4WC3xYLnH96SMuLi9x8/kLWqlQMwbGapRVNflVtjXZsgLjDFxwHKsjTqLGcUQRSOa3r/dYrVb4sd3i8fsDdrsdBOeQ9CzOM+mMmi5L2U7PFVJCa41GCAzDK8JI7CoBwgLaAz8boCX/SEmuE12oSVFJRM2kTlCB/eEXFeOT0kx+IpsIc1M2D1sI5SBNAFMBQgeoLlIc0WoL2Roo3UOqHsr0pE5P1phuauIbQtt1uLu9RdU4PImAloieGg/eBhyYRyUjhElUKKKUeS/gN4/YswAXcSY7N8VSU9brzaSQq1mV0JGIZrUlkdfkc/JllxnGFzyreo0iz4+kD+76ROoGdH6kPxxmUCz0nM9x58b3x8YYMw92b+GdPdu/Ie/lF/0LfwB2UgI7DNGCCQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/046bd629eaa89576829c08e8dcd149ef/a120c/agento-popup.png\"\n        srcset=\"/static/046bd629eaa89576829c08e8dcd149ef/5a46d/agento-popup.png 300w,\n/static/046bd629eaa89576829c08e8dcd149ef/a120c/agento-popup.png 443w\"\n        sizes=\"(max-width: 443px) 100vw, 443px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>로켓펀치, 원티드, 잡플래닛 등 요즘 IT업계에서 특히 많이 사용되고 있는 구인 구직 사이트에서 편하게 해당 업체의 병역지정업체 여부를 보여주는 확장프로그램입니다!</p>\n<p>해당 페이지에서 회사 이름을 가져와서 <a href=\"https://work.mma.go.kr/\">산업지원 병역일터</a> 사이트에 쿼리를 보내 정보를 가져온 후, 보기 쉽게 병역정보 div를 추가해주는 방식이죠! </p>\n<ul>\n<li>Github : <a href=\"https://github.com/cereme/agento\">https://github.com/cereme/agento</a></li>\n<li>Chrome web store : <a href=\"https://chrome.google.com/webstore/detail/agento/ifnibakljlmafjjcbekkmjghggcjkckm?hl=ko&#x26;authuser=0\">https://chrome.google.com/webstore/detail/agento/ifnibakljlmafjjcbekkmjghggcjkckm?hl=ko&#x26;authuser=0</a></li>\n</ul>\n<h1 id=\"이번에-배워간-것\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%B2%88%EC%97%90-%EB%B0%B0%EC%9B%8C%EA%B0%84-%EA%B2%83\" aria-label=\"이번에 배워간 것 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이번에 배워간 것</h1>\n<p>외주라든지, 회사 프로젝트라든지, 이런 성격의 일에서는 항상 최상의 퍼포먼스로 경제성을 신경 써서 작업해야하기 때문에 대개 내가 배울 점을 신경써서 작업하기 힘든데, 토이프로젝트에서는 내가 배우고 싶었던 것, 하고 싶었던 것을 위주로 작업할 수 있어서 재미있습니다.</p>\n<p>프론트엔드 개발을 조금씩 하면서 항상 vue-cli라든지, next.js, create-react-app 등에서 사전에 제공된 webpack 템플릿을 사용하기만 했는데, 이번에는 직접 webpack의 필요성(!)을 깨닫고 처음부터 webpack 설정을 해본게 뿌듯하네요.</p>\n<h1 id=\"webpack\" style=\"position:relative;\"><a href=\"#webpack\" aria-label=\"webpack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Webpack</h1>\n<p>사실 이전에도 간단한 크롬 확장프로그램을 만들어본 적이 있었습니다. </p>\n<p>다만 그 때는 한가지 종류의 사이트에서 한 가지 종류의 동작만 하면 되었기 때문에 background script(페이지와 별도로 동작하는 스크립트), 그리고 inject script(페이지에 삽입하게 되는 스크립트) 각각 한 종류씩만 작성해서 bundling해서 배포했습니다.</p>\n<p>하지만 이번에는 원티드, 로켓펀치, 잡플래닛 이 세가지 종류의 사이트를 감지할 것이고 또 그 안에서도 페이지 종류가 나뉘기 때문에 뭔가 디자인 패턴을 적용해서 잘 설계해야 나중에 코드를 수정할 때 골머리를 덜 앓겠다 싶은 생각이 들었죠.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token string\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"matches\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"*://*.wanted.co.kr/*\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"*://wanted.co.kr/*\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"all_frames\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"src/utils.js\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"src/vendors/wanted.js\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"src/strategyFactory.js\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"src/inject.js\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"run_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"document_end\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>(manifest.json 내용 중 일부분입니다. matches 안의 패턴에 일치하는 문서에 대해서 js 파일들을 삽입하겠다는 뜻입니다.)</p>\n<p>strategy factory 패턴을 적용해서 이런 식으로 작성하면 되겠다 싶었는데, “js” Array의 순서에 따라서 에러가 발생하는겁니다!</p>\n<p><code class=\"language-text\">utils.js</code>에 <code class=\"language-text\">Strategy</code> 클래스의 정의가 있고, <code class=\"language-text\">vendors/wanted.js</code>에 <code class=\"language-text\">Strategy</code> 클래스를 상속받은 각각 페이지의 구현이 있고, <code class=\"language-text\">strategyFactory.js</code>에 각 페이지에 어떤 <code class=\"language-text\">Strategy</code> 클래스의 구현체가 패밍되어야할 지 정해주는 팩토리 메소드가 있고, 최종적으로 <code class=\"language-text\">inject.js</code>가 페이지에 삽입되는 형식이기 때문에, 저 순서로 로딩을 할 수 있도록 <code class=\"language-text\">manifest.js</code>를 작성해주니 제대로 동작하긴 했습니다.</p>\n<p>그래서 열심히 구글링을 한 후, webpack 적용을 시작해봤습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">@ src/inject.js\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> import {strategyFactory} from './strategyFactory';\n</span></span>\n@ src/strategyFactory.js\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> import { WantedCompanyPageStrategy } from './vendors/wanted';\n</span></span>...\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> export {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   strategyFactory\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> } \n</span></span>\n@ src/utils.js\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> export {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   Strategy,\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   getElementByXpath,\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   waitUntilElementExistsBySelector,\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   waitUntilElementExistsByXPath\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> } \n</span></span>\n@ src/vendors/wanted.js\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> import { Strategy, waitUntilElementExistsByXPath, getElementByXpath } from '../utils';\n</span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> export {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   WantedCompanyPageStrategy\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> } </span></span></code></pre></div>\n<p>일단 이렇게 ES6 module 방식을 적용해서 어떤 모듈에서 어떤 모듈을 참조하는 지 명확히 webpack이 알 수 있도록 설정해주었습니다.</p>\n<p>그리고 <code class=\"language-text\">webpack.config.js</code>에 이렇게만 설정해주면 webpack에서 의존성을 잘 따라가서 단일 bundled js파일을 빌드 해줍니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    entry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'content-script'</span><span class=\"token operator\">:</span> <span class=\"token string\">'./src/inject.js'</span><span class=\"token punctuation\">,</span>\n        background<span class=\"token operator\">:</span> <span class=\"token string\">'./src/background.js'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>맨날 preset webpack 설정만 봤지, 만드는건 처음이라 이것저것 만들어보기도 했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                test<span class=\"token operator\">:</span> <span class=\"token regex\">/\\.(js|jsx)$/</span><span class=\"token punctuation\">,</span>\n                use<span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>이렇게 babel도 붙여보고,</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>mode <span class=\"token operator\">===</span> <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        config<span class=\"token punctuation\">.</span>watch <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        config<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">ChromeExtensionReloader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                port<span class=\"token operator\">:</span> <span class=\"token number\">9039</span><span class=\"token punctuation\">,</span>\n                reloadPage<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                entries<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                    contentScript<span class=\"token operator\">:</span> <span class=\"token string\">'content-script'</span><span class=\"token punctuation\">,</span>\n                    background<span class=\"token operator\">:</span> <span class=\"token string\">'background'</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>webpack을 개발하는 도중, 손쉽게 hot-reload를 적용해주는 <a href=\"https://www.npmjs.com/package/webpack-chrome-extension-reloader\">Webpack Chrome Extension Reloader</a>를 발견해서 적용해보기도 했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">CopyPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            patterns<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span><span class=\"token operator\">:</span> <span class=\"token string\">'src/index.html'</span><span class=\"token punctuation\">,</span> to<span class=\"token operator\">:</span> <span class=\"token string\">'index.html'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span><span class=\"token operator\">:</span> <span class=\"token string\">'src/index.css'</span><span class=\"token punctuation\">,</span> to<span class=\"token operator\">:</span> <span class=\"token string\">'index.css'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span><span class=\"token operator\">:</span> <span class=\"token string\">'./icon128.png'</span><span class=\"token punctuation\">,</span> to<span class=\"token operator\">:</span> <span class=\"token string\">'icon128.png'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>CopyPlugin을 사용해서 static file도 복사했죠. 물론 production mode로 빌드하면 바로 Chrome web store에 올릴 수 있도록 zip파일로 번들링 하는 기능도 만들었습니다!</p>\n<p>그래서 덮어놓고 쓰던 webpack이란 도구가 사실 되게 customizable한 도구이고, 널리 배포된 정교하게 만든 webpack 설정은 잘 모르는 사람들도 잘 쓸 수 있게 만든 대단한 결과물이라는 점을 깊게 느꼈습니다…</p>\n<h1 id=\"browser-extension에-대한-사소한-사실들\" style=\"position:relative;\"><a href=\"#browser-extension%EC%97%90-%EB%8C%80%ED%95%9C-%EC%82%AC%EC%86%8C%ED%95%9C-%EC%82%AC%EC%8B%A4%EB%93%A4\" aria-label=\"browser extension에 대한 사소한 사실들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Browser extension에 대한 사소한 사실들</h1>\n<h2 id=\"tapupdated\" style=\"position:relative;\"><a href=\"#tapupdated\" aria-label=\"tapupdated permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TapUpdated</h2>\n<p>content-script는 기본적으로 페이지가 이동할 때마다 호출됩니다.</p>\n<p>그러면 SPA(Single Page Application)에서는 어쩌죠? (사실 SPA에서만이 아니라, Multi Page Application에서도 AJAX를 통해 중요한 정보를 로딩하는 사이트가 있기 때문에 MPA에서도 발생하는 문제입니다.)</p>\n<p><a href=\"https://stackoverflow.com/questions/34957319/how-to-listen-for-url-change-with-chrome-extension\">https://stackoverflow.com/questions/34957319/how-to-listen-for-url-change-with-chrome-extension</a></p>\n<p>background.js <code class=\"language-text\">chrome.tabs.onUpdated</code> 이벤트 핸들러를 다음과 같이 작성해서, </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">chrome<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onInstalled<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  chrome<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span>onUpdated<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tabId<span class=\"token punctuation\">,</span> changeInfo</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>changeInfo<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'complete'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      chrome<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tabId<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        message<span class=\"token operator\">:</span> <span class=\"token string\">'TabUpdated'</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>inject할 스크립트에서 <code class=\"language-text\">TabUpdated</code> 메시지를 받으면 다시 회사 정보를 파싱해서 업데이트 할 수 있도록 작성했습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">chrome<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>message <span class=\"token operator\">===</span> <span class=\"token string\">'TabUpdated'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> strategy <span class=\"token operator\">=</span> <span class=\"token function\">strategyFactory</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>strategy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      strategy<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"크롤링은-어떻게-해온거죠\" style=\"position:relative;\"><a href=\"#%ED%81%AC%EB%A1%A4%EB%A7%81%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4%EC%98%A8%EA%B1%B0%EC%A3%A0\" aria-label=\"크롤링은 어떻게 해온거죠 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>크롤링은 어떻게 해온거죠?</h2>\n<p>혹시 맨 위에서 설명한 구현방식을 보시고 <em>CORS에 걸리지 않을까?</em> 생각하셨을 수도 있습니다.</p>\n<p>병무청에서 제공하는 공식 Open API를 사용한 것이 아니라 페이지에 요청을 보내 파싱하는 방식이기 때문이죠. </p>\n<p>(사실 Open API를 사용하는 식으로 가려고 했지만 <a href=\"https://data.go.kr\">https://data.go.kr</a> 에서 열심히 뒤져봐도 최신화된 데이터를 찾을 수 없었습니다.)</p>\n<p>하지만, background script에서 보내는 XHR 요청은 Same origin policy를 적용받지 않습니다.</p>\n<blockquote>\n<p>Extension origins aren’t so limited - a script executing in an extension’s background page or foreground tab can talk to remote servers outside of its origin, as long as the extension requests cross-origin permissions.</p>\n</blockquote>\n<p>자세한 내용은 <a href=\"https://developer.chrome.com/extensions/xhr\">https://developer.chrome.com/extensions/xhr</a> 를 참고해주세요</p>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>특정 페이지에서 외부의 리소스를 가져와 추가로 알고싶은 정보를 한 페이지에서 제공해줄 수 있다는 아이디어는 <a href=\"https://solved.ac/\">solved.ac</a>에서 영감을 받았습니다. 감사드립니다 🙏</p>\n<p>여러분들도 어떤 정보를 얻기 위해 두 번 검색한 경험이 있다면 크롬 확장프로그램을 만들어보아요!</p>\n<p>끝까지 읽어주셔서 감사합니다 :)</p>","frontmatter":{"title":"산업기능요원 TO 정보 확장프로그램, agento 개발기","date":"2020-11-28"}}},"pageContext":{"slug":"/frontend/agento-extension-retrospective/","previous":{"fields":{"slug":"/frontend/strapi-on-company-homepage/"},"frontmatter":{"title":"strapi 간단 사용기 (in 회사 홈페이지)","category":"frontend","draft":false}},"next":{"fields":{"slug":"/frontend/i18n-flask-babel-next-i18next/"},"frontmatter":{"title":"두 번 만드는 i18n: Flask-babel to next-i18next","category":"frontend","draft":false}}}}}